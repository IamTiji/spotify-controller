<!DOCTYPE html>

<html>
    <head>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,550,0,0"/>
        <title>Guide</title>
        <script>
            var currentStep = 1;

            const step = "Step %s"
            const steps = [
                "Go to <a href=\"https://developer.spotify.com/dashboard\">Spotify Developer Dashboard</a> and create a new app. If it prompts you to login, do so with your account you are willing to link with. You might need to agree to Spotify's ToS.",
                "Fill 'Redirect URIs' as <code>http://127.0.0.1:25566/callback</code>. Fields other then that doesn't matter, you can fill with anything. Click on 'Add' in 'Redirect URIs' section. Then check on agreement below. Finally click 'Save' on the bottom of the page.",
                "Click on 'Show client secret' and copy both client ID and client secret. You will need to type them in next step. I have blured my ID, but your ID won't be blured.",
            ]
            const img = [
                "/step1.png",
                "/step2.png",
                "/step3.png",
            ]

            function updateStep(i) {
                if (i > steps.length) {
                    document.getElementById('instructions').style.display = "none";
                    document.getElementById('client_info').classList.add('shown');
                } else {
                    document.getElementById('instructions').style.display = null;
                    document.getElementById('client_info').classList.remove('shown');

                    document.getElementById('step_n').textContent = step.replace("%s", i);
                    document.getElementById('description').innerHTML = steps[i - 1];
                    document.getElementById('help_img').src = img[i - 1];
                    document.getElementById('popup_img').src = img[i - 1];
                }
                highlighted = document.getElementsByClassName('highlighted');
                if (highlighted.length > 0) highlighted[0].classList.remove('highlighted');
                document.getElementsByClassName('steps_dot')[i - 1].classList.add('highlighted');
            }

            function redirect() {
                fetch("http://127.0.0.1:25566/data", {
                    "headers": {
                        "Client-Id": document.getElementById('clientid').value,
                        "Secret": document.getElementById('clientsecret').value
                    },
                    "method": "PUT"
                }).then(() => {
                    url = "https://accounts.spotify.com/authorize?response_type=code&client_id=" + document.getElementById('clientid').value + "&redirect_uri=http://127.0.0.1:25566/callback&show_dialog=true&scope=user-read-playback-state%20user-modify-playback-state%20user-read-currently-playing%20user-read-private%20user-library-read%20user-library-modify";
                    window.location.href = url;
                });
            }

            document.addEventListener("DOMContentLoaded", function() {
                document.getElementById('steps').innerHTML = (`<div class="steps_dot"></div>`).repeat(steps.length + 1);
                updateStep(currentStep);

                document.getElementById('previous').addEventListener('click', function() {
                    if (currentStep > 1) {
                        currentStep--;
                        updateStep(currentStep);
                    }
                });
                document.getElementById('next').addEventListener('click', function() {
                    if (currentStep < steps.length + 1) {
                        currentStep++;
                        updateStep(currentStep);
                    }
                });
                document.getElementById('help_img').addEventListener('click', function() {
                    document.getElementById('popup').showModal();
                });
                document.getElementById('popup_img').addEventListener('click', function() {
                    document.getElementById('popup').close();
                });
            });
        </script>
    </head>
    <body>
        <div id="root">
            <div id="container">
                <div id="instructions">
                    <img id="help_img">
                    <span id="step_n">Step 1</span>
                    <span id="description"></span>
                </div>
                <div id="client_info">
                    <form>
                        <h3>Type out your client id and secret:</h3>
                        <label for="clientid">Client ID:</label>
                        <input type="text" id="clientid" required>
                        <label for="clientsecret">Client Secret:</label>
                        <input type="text" id="clientsecret" required>
                        <button type="button" onclick="redirect()">Connect</button>
                    </form>
                </div>
                <span id="previous" class="material-symbols-rounded icon">arrow_back</span>
                <span id="next" class="material-symbols-rounded icon">arrow_forward</span>
            </div>
            <div id="steps"></div>
            <dialog id="popup">
                <img id="popup_img">
            </dialog>
        </div>
    </body>
</html>