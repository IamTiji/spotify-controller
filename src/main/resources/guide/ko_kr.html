<!DOCTYPE html>

<html>
    <head>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,550,0,0"/>
        <title>Guide</title>
        <script>
            var currentStep = 1;

            const step = "%s단계"
            const steps = [
                "<a href=\"https://developer.spotify.com/dashboard\">스포티파이 개발자 대쉬보드</a>로 접속해 새 앱을 만들어 주세요 ('Create app'). 로그인을 해달라 할 경우, 연결하려는 계정과 같은 계정으로 로그인 해주세요. 스포티파이의 사용자 약관에 동의해야 됄수도 있습니다.",
                "'Redirect URIs'를 <code>http://127.0.0.1:25566/callback</code>로 채워주세요. 나머지 항목은 아무렇게나 해도 괜찮습니다. 'Redirect URIs'항목에서 'Add'라고 쓰인 버튼을 눌러주세요. 웹사이트 밑에 있는 체크박스를 누르고, 'Save' 버튼을 눌러주세요.",
                "'Show client secret'를 누른 후 client ID와 client secret를 복사해주세요. 다음 단계에서 필요합니다. 제 ID를 흐리게 해놨지만 원래 흐리지 않은게 정상입나다.",
            ]
            const img = [
                "/step1.png",
                "/step2.png",
                "/step3.png",
            ]

            function updateStep(i) {
                if (i > steps.length) {
                    document.getElementById('instructions').style.display = "none";
                    document.getElementById('client_info').classList.add('shown');
                } else {
                    document.getElementById('instructions').style.display = null;
                    document.getElementById('client_info').classList.remove('shown');

                    document.getElementById('step_n').textContent = step.replace("%s", i);
                    document.getElementById('description').innerHTML = steps[i - 1];
                    document.getElementById('help_img').src = img[i - 1];
                    document.getElementById('popup_img').src = img[i - 1];
                }
                highlighted = document.getElementsByClassName('highlighted');
                if (highlighted.length > 0) highlighted[0].classList.remove('highlighted');
                document.getElementsByClassName('steps_dot')[i - 1].classList.add('highlighted');
            }

            function redirect() {
                fetch("http://127.0.0.1:25566/data", {
                    "headers": {
                        "Client-Id": document.getElementById('clientid').value,
                        "Secret": document.getElementById('clientsecret').value
                    },
                    "method": "PUT"
                }).then(() => {
                    url = "https://accounts.spotify.com/authorize?response_type=code&client_id=" + document.getElementById('clientid').value + "&redirect_uri=http://127.0.0.1:25566/callback&show_dialog=true&scope=user-read-playback-state%20user-modify-playback-state%20user-read-currently-playing%20user-read-private%20user-library-read%20user-library-modify";
                    window.location.href = url;
                });
            }

            document.addEventListener("DOMContentLoaded", function() {
                document.getElementById('steps').innerHTML = (`<div class="steps_dot"></div>`).repeat(steps.length + 1);
                updateStep(currentStep);

                document.getElementById('previous').addEventListener('click', function() {
                    if (currentStep > 1) {
                        currentStep--;
                        updateStep(currentStep);
                    }
                });
                document.getElementById('next').addEventListener('click', function() {
                    if (currentStep < steps.length + 1) {
                        currentStep++;
                        updateStep(currentStep);
                    }
                });
                document.getElementById('help_img').addEventListener('click', function() {
                    document.getElementById('popup').showModal();
                });
                document.getElementById('popup_img').addEventListener('click', function() {
                    document.getElementById('popup').close();
                });
            });
        </script>
    </head>
    <body>
        <div id="root">
            <div id="container">
                <div id="instructions">
                    <img id="help_img">
                    <span id="step_n"></span>
                    <span id="description"></span>
                </div>
                <div id="client_info">
                    <form>
                        <h3>Client ID와 Client Secret를 입력해주세요:</h3>
                        <label for="clientid">Client ID:</label>
                        <input type="text" id="clientid" required>
                        <label for="clientsecret">Client Secret:</label>
                        <input type="text" id="clientsecret" required>
                        <button type="button" onclick="redirect()">연결하기</button>
                    </form>
                </div>
                <span id="previous" class="material-symbols-rounded icon">arrow_back</span>
                <span id="next" class="material-symbols-rounded icon">arrow_forward</span>
            </div>
            <div id="steps"></div>
            <dialog id="popup">
                <img id="popup_img">
            </dialog>
        </div>
    </body>
</html>